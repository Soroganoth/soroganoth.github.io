[{"content":"Working as a cloud security architect in a consulting role in Norway.\nInterest areas are:\nAzure/Azure AD Attacker TTPs Cloud Security with some dabbling in Web Application Security and Kubernetes Security\nCertifications: Microsoft: SC-100: Cybersecurity Architect Expert AZ-500: Azure Security Engineer Associate MS-500: Security Administrator Associate SC-200: Security Operations Analyst Associate Hashicorp Terraform Associate Linux Foundation Certified Kubernetes Administrator Pentester Academy Certified Az AD Red Team Professional (CARTP) Certified Azure Web Application Security Professional (CAWASP) ","permalink":"https://soroganoth.com/about/abooutme/","summary":"Working as a cloud security architect in a consulting role in Norway.\nInterest areas are:\nAzure/Azure AD Attacker TTPs Cloud Security with some dabbling in Web Application Security and Kubernetes Security\nCertifications: Microsoft: SC-100: Cybersecurity Architect Expert AZ-500: Azure Security Engineer Associate MS-500: Security Administrator Associate SC-200: Security Operations Analyst Associate Hashicorp Terraform Associate Linux Foundation Certified Kubernetes Administrator Pentester Academy Certified Az AD Red Team Professional (CARTP) Certified Azure Web Application Security Professional (CAWASP) ","title":"About Me"},{"content":"I recently found myself needing to create some Azure watchlists using Bicep templates.\nAs there did not seem to be much documentation about this, and my lacking understanding of child resources in Bicep, this took way longer then it needed to be, so i figured I would document this.\nMicrosoft Bicep Watchlist Reference: Bicep Reference\nQuick Comments about the template A Watchlist cannot be empty, so you need to some example value. The Source property does not seem to to do anything, but for whatever reason needs to be \u0026quot;Remote Storage\u0026quot; or \u0026quot;Local File\u0026quot;.\nDeploy with new Workspace This caused me some confusion because in the Azure portal watchlists can only be accessed from the Sentinel workspace. As such one may think it would be a child resource for the Sentinel workspace. It is in fact not, but a child resource of log analytics. This then requires some advanced-ish Bicep usage as this is a child resource of the log analytics workspace, but also depends on the sentinel solution.\nExample template for deploying Log Analytics workspace, with Sentinel and a Watchlist.\n//api docs https://docs.microsoft.com/en-us/azure/templates/microsoft.compute/virtualmachines?tabs=bicep // The workspace name can contain only letters, numbers and \u0026#39;-\u0026#39;. The \u0026#39;-\u0026#39; shouldn\u0026#39;t be the first or the last symbol. param workspacename string param location string = \u0026#39;norwayeast\u0026#39; param retentionInDays int = 365 // Log analytics workspace resource loganalyticsworkspace \u0026#39;Microsoft.OperationalInsights/workspaces@2021-06-01\u0026#39; = { name: \u0026#39;${workspacename}LA\u0026#39; location: location properties: { sku: { name: \u0026#39;PerGB2018\u0026#39; } retentionInDays: retentionInDays } } // End of Log Analytics workspace // Sentinel resource sentinelsolution \u0026#39;Microsoft.OperationsManagement/solutions@2015-11-01-preview\u0026#39; = { name: \u0026#39;SecurityInsights(${loganalyticsworkspace.name})\u0026#39; location: location plan: { name: \u0026#39;SecurityInsights(${loganalyticsworkspace.name})\u0026#39; product: \u0026#39;OMSGallery/SecurityInsights\u0026#39; publisher: \u0026#39;Microsoft\u0026#39; promotionCode: \u0026#39;\u0026#39; } properties: { workspaceResourceId: loganalyticsworkspace.id } } resource watchlist1 \u0026#39;Microsoft.SecurityInsights/watchlists@2021-04-01\u0026#39; = { name: \u0026#39;list1\u0026#39; scope: loganalyticsworkspace dependsOn: [ sentinelsolution ] properties: { contentType: \u0026#39;text/csv\u0026#39; defaultDuration: \u0026#39;30\u0026#39; description: \u0026#39;test1\u0026#39; displayName: \u0026#39;test1\u0026#39; isDeleted: false itemsSearchKey: \u0026#39;ExampleSearchKey\u0026#39; numberOfLinesToSkip: 0 provider: \u0026#39;Whatever\u0026#39; rawContent: \u0026#39;ExampleSearchKey\\nExampleValue\u0026#39; source: \u0026#39;Remote storage\u0026#39; watchlistAlias: \u0026#39;TST1\u0026#39; } } Deploy to existing workspaces The template is pretty simple, however the parent value needs to be a resource datatype, not just a string. This is why you need the placeholder of the existing workspace.\nparam workspacename string resource loganalyticsworkspace \u0026#39;Microsoft.OperationalInsights/workspaces@2021-06-01\u0026#39; existing = { name: workspacename } resource watchlist1 \u0026#39;Microsoft.SecurityInsights/watchlists@2021-04-01\u0026#39; = { name: \u0026#39;list2\u0026#39; scope: loganalyticsworkspace properties: { contentType: \u0026#39;text/csv\u0026#39; defaultDuration: \u0026#39;30\u0026#39; description: \u0026#39;test2\u0026#39; displayName: \u0026#39;test2\u0026#39; itemsSearchKey: \u0026#39;ExampleSearchKey\u0026#39; numberOfLinesToSkip: 0 provider: \u0026#39;Whatever\u0026#39; rawContent: \u0026#39;ExampleSearchKey\\nExampleValue\u0026#39; source: \u0026#39;Local file\u0026#39; watchlistAlias: \u0026#39;TST2\u0026#39; } } ","permalink":"https://soroganoth.com/post/shorts/sentinel_bicep_watchlist/","summary":"I recently found myself needing to create some Azure watchlists using Bicep templates.\nAs there did not seem to be much documentation about this, and my lacking understanding of child resources in Bicep, this took way longer then it needed to be, so i figured I would document this.\nMicrosoft Bicep Watchlist Reference: Bicep Reference\nQuick Comments about the template A Watchlist cannot be empty, so you need to some example value.","title":"Deploy Azure Sentinel Watchlists with Bicep"}]